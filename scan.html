<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>QR Code Scanner</title>

    <!-- Bootstrap for styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Include HTML5 QR Code Scanner library -->
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>

    <style>
        body { font-family: Arial, sans-serif; }
        #qrResult { margin-top: 20px; }
        #stopScan { margin-top: 20px; display: none; }
        #scanner-container { width: 100%; max-width: 600px; margin: auto; }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">QR Code Scanner</span>
    </div>
</nav>

<div class="container mt-4">
    <h2>Scan a QR Code</h2>

    <!-- Scanner Container -->
    <div id="scanner-container">
        <div id="reader" style="width: 100%; height: 300px;"></div>
    </div>
    
    <!-- Scan result -->
    <div id="qrResult" class="mt-3">
        <h4>QR Code Data:</h4>
        <pre id="qrData">Scan a QR code to see the result.</pre>
    </div>

    <!-- Start and Stop buttons -->
    <button id="stopScan" class="btn btn-danger" onclick="stopScan()">Stop Scan</button>
</div>

<script>
    // Initialize the HTML5 QR Scanner
    const html5QRCode = new Html5Qrcode("reader");

    // Function to start scanning
    function startScan() {
        html5QRCode.start(
            { facingMode: "environment" }, // Use the environment-facing camera
            {
                fps: 10, // Frames per second (increase to improve scan speed)
                qrbox: 250, // Size of the scanning box
            },
            (decodedText, decodedResult) => {
                // QR code successfully scanned
                document.getElementById("qrData").innerText = decodedText;
                stopScan(); // Stop scanning after successful scan
            },
            (errorMessage) => {
                // Handle errors during the scanning process
                console.log("QR code scanning error: ", errorMessage);
            }
        ).then(() => {
            // Hide the start button after scanner has started
            document.getElementById("stopScan").style.display = "inline-block";
        }).catch((err) => {
            // Handle error if camera access fails
            console.error("Error starting QR scanner:", err);
            alert("Could not access the camera. Please check permissions.");
        });
    }

    // Stop the scanning process
    function stopScan() {
        html5QRCode.stop().then(() => {
            console.log("QR Scanner stopped");
            document.getElementById("stopScan").style.display = "none"; // Hide stop button
        }).catch((err) => {
            console.error("Error stopping QR scanner:", err);
        });
    }

    // Start the scanning process when the page loads
    window.onload = startScan;
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
